

# 이중모드, 하드웨어 보호

### 이중모드

- **한 컴퓨터를 여러 사람이 동시에 사용하는 환경**

  - 또는 한 사람이 여러 개의 프로그램을 동시에 사용

  - 한 사람의 고의/실수 프로그램이 전체 영향

    - STOP, HALT, RESET 등

    EX) 서버 컴퓨터 : 어떤 사용자의 영향으로 시스템이 다운되는 경우 다른 사용자들에게 영향을 미칠 수 있다.

    ⇒ `관리자 모드`와 `사용자 모드` 두 가지로 관리

    

- **사용자 프로그램은 STOP 등 `치명적 명령 사용 불가하게!`**

  - 사용자 (user) 모드 vs 관리자 (supervisor) 모드

    ⇒ 이중 모드 (dual mode)

  - 관리자 모드 = 시스템 모드 = 모니터 모드 = 특권 모드

  - – Supervisor, system, monitor, priviliged mode

  - 

- **특권 명령 (privileged instructions)**

  - STOP, HALT, RESET, SET_TIMER, SET_HW, ...

    

- **이중 모드 (dual mode)**

  - 레지스터에 모드를 나타내는 플래그(flag)

    ⇒ FLAG가 0인지 1인지에 따라 모드 구분

    ⇒CPU는 현재 FLAG를 보고 명령을 수행 해도 되는지 안되는지 판단하여 유저의 시스템 접근을 차단함 (OS에게 인터럽트를 걸어 사용자 프로그램 종료 명령<메모리에서 제거>을 내림)

  - 운영체제 서비스 실행될 때는 관리자 모드 ⇒ FLAG = 1

  - 사용자 프로그램(게임 등) 실행될 때는 OS에서 사용자 모드로 변경 ⇒ FLAG = 0

  - 하드웨어/소프트웨어 인터럽트 발생하면 관리자 모드 ⇒사용자의 요청이있을 경우 EX) 게임 스코어를 하드디스크에 저장할 때, 사용자 모드로는 접근 불가능. OS에게 게임 스코어 저장 요청하면 인터럽트가 발생하고 관리자 모드로 변경됨, FLAG : 0 → 1

  - 운영체제 서비스가 끝나면 다시 사용자 모드, FLAG : 1→0

    

- **일반적 프로그램의 실행**

  - 프로그램 적재 (on memory)

  - User mode → (키보드, 마우스) → system mode (ISR) → user mode → (모니터, 디스크, 프린터) → system mode → user mode

    

------

### **하드웨어 보호**

- **입출력장치 보호 (**Input/output device protection)

  - 사용자의 잘못된 입출력 명령 

    - 다른 사용자의 입출력, 정보 등에 방해
    - 예: 프린트 혼선, 리셋 등
    - 예: 다른 사람의 파일 읽고 쓰기 (하드디스크)

  - 해결법 

    - 입출력 명령을 특권명령으로: IN, OUT⇒관리자 모드에서만 가능
    - 입출력을 하려면 운영체제에게 요청하고 (system mode 전환),
    - 운영체제가 입출력 대행; 마친 후 다시 user mode 복귀
    - 올바른 요청이 아니면 운영체제가 거부

  - 사용자가 입출력 명령을 직접 내린 경우? 

    - Privileged instruction violation ⇒프로그램 강제종료

      

- **메모리 보호 (**Memory protection)

  - 다른 사용자 메모리 또는 운영체제 영역 메모리 접근

    - 우연히 또는 고의로 다른 사용자 정보/프로그램에 대한 해킹 가능
    - 운영체제 해킹 가능

  - 해결법

    - MMU 를 두어 다른 메모리 영역(OS, 또는 다른 사용자의 영역<주소>) 침범을 감시하도록 함 (Memory Management Unit)

    - MMU 설정은 특권명령: 운영체제만 바꿀 수 있다

    - 다른 사용자 또는 운영체제 영역 메모리 접근 시도를 하게된다면? 

      - Segment violation  ⇒ 강제 종료

        

- **CPU 보호 (CPU protection)**

  - 한 사용자가 실수 또는 고의로 CPU 시간 독점
    - 예: while (n = 1) …
       ⇒ == 을 =로 잘못써서 무한 루프를 돌게 되는 경우 ⇒ 다른 사용자의 프로그램 실행 불가
  - 해결법
    - Timer 를 두어 일정 시간 경과 시 타이머 인터럽트
    - 인터럽트 > 운영체제 > 다른 프로그램으로 강제 전환 ⇒ 한 사용자 또는 프로그램이 독점하는 것을 막음